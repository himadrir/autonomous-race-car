<?xml version="1.0"?>
<launch>    
	<rosparam command="load" file="$(find controller)/param/setup.yaml" />

	<arg name="enable_mapping" default="false"/>
	<arg name="enable_amcl" default="false"/>
	<arg name="enable_wf" default="true"/>
	<arg name="enable_cam" default="false"/>
	<arg name="enable_als" default="false"/>

	<node name="mux_control" pkg="controller" type="mux_control.py" output="screen"/>

	<!--<node name="motor_controller" pkg="rosserial_python" type="serial_node.py" output="screen">
		<param name="port" value="/dev/control"/>
	</node>-->
	<!-- todo: <include-->

	<include file="$(find controller)/launch/include/vesc.launch"/>

	<node if="$(arg enable_wf)" name="wall_follow" pkg="controller" type="wall_follow.py" output="screen"/>
	<include if="$(arg enable_cam)" file="$(find zed_wrapper)/launch/zedm.launch" />
	
	<arg name="transforms" default="0 0 0.035 0 0 0 1 base_footprint base_link" />
	<arg name="imu_transforms" default="0.125 0 0.11 0 0 0 1 base_link imu"/>
		
  	<param name="transforms" value="$(arg transforms)" />
  	<param name="imu_transforms" value="$(arg imu_transforms)"/>
	<!-- <param name="cam_transforms" value="$(arg cam_transforms)" /> -->
  	
	<node name="base_link_basefootprint_tf" pkg="tf2_ros" type="static_transform_publisher" args="$(arg transforms)" />
	<node name="base_link_imu_tf" pkg="tf2_ros" type="static_transform_publisher" args="$(arg imu_transforms)" />
	<!-- <node name="base_link_zedm_tf" pkg="tf2_ros" type="static_transform_publisher" args="$(arg cam_transforms)" /> -->
	
	<include file="$(find ldlidar_stl_ros)/launch/ld19.launch"/>



  	<!-- Run the EKF Localization node -->

	<include file="$(find witmotion_ros)/launch/witmotion.launch"/>
	
	<node pkg="imu_filter_madgwick" type="imu_filter_node" name="imu_filter">
		<param name="use_mag" value = "false"/>
		<param name="use_magnetic_field_msg" value = "false"/>
		<param name="publish_tf" value="false" />
		<param name="fixed_frame" value="base_link"/>
		<param name="world_frame" value="enu" />
		<param name="orientation_stddev" value="0.05" />
  	</node>
	
	<include file="$(find laser_scan_matcher_odometry)/launch/example.launch"/>

	<node pkg="robot_localization" type="ekf_localization_node" name="ekf_localization">
        	<rosparam command="load" file="$(find controller)/param/ekf.yaml"/>
  	</node>

	<include if="$(arg enable_amcl)" file="$(find controller)/launch/include/amcl.launch"/>
	<include if="$(arg enable_mapping)" file="$(find hector_slam_launch)/launch/tutorial.launch" />
	
	<group if="$(arg enable_als)" >
		<arg name="map_file" default="$(find controller)/maps/map1.yaml"/>
                <node name="map_server" pkg="map_server" type="map_server" args="$(arg map_file)" />
		<include file="$(find als_ros)/launch/mcl.launch"/>
	</group>
</launch>
